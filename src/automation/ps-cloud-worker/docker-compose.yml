version: '3.8'

services:
  worker:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - WORKER_ID=worker-dev-01
      - MAX_PARALLELISM=2
      - SERVICE_BUS_NAMESPACE=your-namespace.servicebus.windows.net
      - JOBS_TOPIC_NAME=worker-jobs
      - RESULTS_TOPIC_NAME=worker-results
      - KEY_VAULT_NAME=your-keyvault-name
      - TARGET_TENANT_ID=your-target-tenant-id
      - APP_ID=your-app-registration-id
      - APP_SECRET_NAME=worker-app-secret
      - APPINSIGHTS_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=https://your-region.in.applicationinsights.azure.com/
      - IDLE_TIMEOUT_SECONDS=0  # Disable idle shutdown for local dev
      # For local development without managed identity, set these:
      # - AZURE_TENANT_ID=your-hosting-tenant-id
      # - AZURE_CLIENT_ID=your-dev-app-id
      # - AZURE_CLIENT_SECRET=your-dev-app-secret
    volumes:
      - ./modules/CustomFunctions:/app/modules/CustomFunctions:ro
